---
classes:
  - 'clamav'
  - 'google_credentials'
  - 'nginx'
  - 'performanceplatform::development'
  - 'performanceplatform::mongo'
  - 'performanceplatform::nginx_logging_formats'
  - 'performanceplatform::nodejs'
  - 'performanceplatform::postgresql_primary'
  - 'postgresql::lib::devel'
  - 'phantomjs'
  - 'python'
  - 'varnish'

performanceplatform::dns::hosts: |
  127.0.0.1 jumpbox-1 monitoring log graphite
  127.0.0.1 frontend-app-1 frontend
  127.0.0.1 frontend-app-2 frontend
  127.0.0.1 backend-app-1 backend
  127.0.0.1 backend-app-2 backend
  127.0.0.1 development-1 development
  127.0.0.1 mongo-1 mongo
  127.0.0.1 mongo-2 mongo
  127.0.0.1 mongo-3 mongo
  127.0.0.1 logs-elasticsearch-1 elasticsearch
  127.0.0.1 logs-elasticsearch-2 elasticsearch
  127.0.0.1 postgresql-primary-1 postgresql-primary
  127.0.0.1 backup-box-1

performanceplatform::mongo::mongo_hosts:
  - 127.0.0.1

python::version:    '2.7'
python::dev:        true
python::virtualenv: true
python::pip:        true

ufw_rules:
  allow-http-from-anywhere:
    port: 80
    ip:   'any'
  allow-https-from-anywhere:
    port: 443
    ip:   'any'
  spotlight-node-debug:
    port: 8080
    ip:   'any'
  allow-stagecraft:
    port: 3204
    ip:   'any'

nginx::names_hash_bucket_size: 128
nginx::confd_purge: true
nginx::vhost_purge: true

vhost_proxies:
  # For spotlight
  spotlight:
    servername:    "%{::spotlight_vhost}"
    ssl:           true
    upstream_port: 3057
  # For backdrop
  backdrop_read:
    servername:    "read.backdrop"
    ssl:           true
    upstream_port: 3038
    proxy_append_forwarded_host: true
  backdrop_write:
    servername:    "write.backdrop"
    ssl:           true
    upstream_port: 3039
    proxy_append_forwarded_host: true
    client_max_body_size: '30m'
  backdrop_admin:
    servername:    "admin.backdrop"
    ssl:           true
    upstream_port: 3203
    proxy_append_forwarded_host: true
  stagecraft:
    servername:    "%{::stagecraft_vhost}"
    ssl:           true
    upstream_port: 3204
  # For varnish
  www:
    servername:    "%{::www_vhost}"
    ssl:           true
    upstream_port: 7999
    client_max_body_size: '30m'
  admin:
    servername:    "%{::admin_vhost}"
    ssl:           true
    upstream_port: 7999
  # For assets
  assets:
    servername:    "%{::assets_vhost}"
    ssl:           true
    upstream_port: 7999

system_packages:
  - cmake
  - libcairo2-dev
  - libjpeg8-dev
  - libpango1.0-dev
  - libgif-dev
  - nfs-common
  - portmap

ruby_packages:
  - bowler
  - foreman

python_packages:
  - virtualenvwrapper

# Same as performanceplatform::postgresql_primary::stagecraft_password
performanceplatform::development::stagecraft_password: "securem8"
