classes:
    - 'performanceplatform::jenkins'
    - 'performanceplatform::deploy'
    - 'python'
    - 'nginx::server'
    - 'google_credentials'
    - 'phantomjs'

performanceplatform::jenkins::lts: 1
performanceplatform::jenkins::plugin_hash:
    git-client:
        version: "1.0.6"
    git:
        version: "1.4.0"
    github:
        version: "1.6"
    github-api:
        version: "1.34"
    multiple-scms:
        version: "0.2"
    saferestart:
        version: "0.3"
    role-strategy:
        version: "1.1.2"
    greenballs:
        version: "1.12"

python::version:    '2.7'
python::dev:        true
python::virtualenv: true

system_packages:
    - libxml2-dev
    - libxslt1-dev

ufw_rules:
    allowhttpfromall:
        port: 80
        ip:   'any'
    allowhttpsfromall:
        port: 443
        ip:   'any'
    allowsshfromanywhere:
        port: 22
        ip:   'any'
    allowelasticsearchfromany:
        port: 9200
        ip:   'any'

vhost_proxies:
    deploy-vhost:
        servername:      "%{::deploy_vhost}"
        ssl:             true
        ssl_redirect:    true
        upstream_server: 'localhost'
        upstream_port:   8080
        access_logs:
            '{name}.access.log.json': 'json_event'
    graphite-vhost:
        servername:      "%{::graphite_vhost}"
        ssl:             true
        ssl_redirect:    true
        upstream_server: 'graphite'
        upstream_port:   80
        forward_host_header: false
        access_logs:
            '{name}.access.log.json': 'json_event'
    alerts-vhost:
        servername:      "%{::alerts_vhost}"
        ssl:             true
        ssl_redirect:    true
        upstream_server: 'alerts'
        upstream_port:   80
        access_logs:
            '{name}.access.log.json': 'json_event'
    elasticsearch-vhost:
        servername:      "%{::elasticsearch_vhost}"
        port:            9200
        upstream_server: 'logging'
        upstream_port:   9200
        proxy_magic:     'limit_except GET HEAD OPTIONS { deny all; }'
        access_logs:
            '{name}.access.log.json': 'json_event'

nginx_conf:
    logging:
        template: performanceplatform/nginx.logging.conf.erb

lumberjack_instances:
    nginx:
        log_files: [ '/var/log/nginx/*.access.log.json' ]
