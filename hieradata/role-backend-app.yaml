---
classes:
  - 'backdrop_collector'
  - 'clamav'
  - 'google_credentials'
  - 'performanceplatform::checks::backdrop'
  - 'performanceplatform::checks::clamav'
  - 'performanceplatform::checks::stagecraft'
  - 'performanceplatform::backdrop_smoke_tests'
  - 'performanceplatform::notifier'
  - 'performanceplatform::pp_nginx'
  - 'performanceplatform::pip'
  - 'performanceplatform::python_lxml_deps'
  - 'python'
  - 'postgresql::lib::devel'

ufw_rules:
  allowhttp:
    port: 80
    ip:   'any'

nginx::confd_purge: true
nginx::vhost_purge: true
nginx::manage_repo: false
nginx::package_ensure: '1.4.4-4~precise0'

performanceplatform::notifier::user: 'deploy'
performanceplatform::notifier::group: 'deploy'
performanceplatform::notifier::cron_definition:
  minute: '0'

gunicorn_apps:
  admin.backdrop:
    port:          3203
    # This is a placeholder until we extract a separate app
    app_module:    'backdrop.admin.app:app'
    user:          'deploy'
    group:         'deploy'
    statsd_prefix: 'backdrop.admin'
  read.backdrop:
    port:          3038
    app_module:    'backdrop.read.api:app'
    user:          'deploy'
    group:         'deploy'
    statsd_prefix: 'backdrop.read'
  write.backdrop:
    port:                 3039
    app_module:           'backdrop.write.api:app'
    user:                 'deploy'
    group:                'deploy'
    statsd_prefix:        'backdrop.write'
    client_max_body_size: '50m'
    timeout:              60
  stagecraft:
    port:            3204
    app_module:      'stagecraft.wsgi:application'
    user:            'deploy'
    group:           'deploy'
    is_django:       true
    timeout:         2

backdrop_collectors:
  performanceplatform-collector:
    user: 'deploy'
    group: 'deploy'
    ensure: 'present'

python::version:    '2.7'
python::dev:        true
python::virtualenv: true
python::pip:        true

performanceplatform::pip::user: 'deploy'
performanceplatform::pip::group: 'deploy'
performanceplatform::pip::pip_cache_path: '/var/cache/pip-download-cache'

lumberjack_instances:
  nginx:
    log_files: [ '/var/log/nginx/*.access.log.json' ]

ruby_packages:
  - curb
  - json
