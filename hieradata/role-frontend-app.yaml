---
classes:
  - 'nginx::server'
  - 'spotlight::app'
  - 'varnish'

spotlight::app::port:       3057
spotlight::app::app_module: 'spotlight:app'
spotlight::app::user:       'deploy'
spotlight::app::group:      'deploy'

ufw_rules:
  allow-http-from-anywhere:
    port: 80
    ip:   'any'
  allow-https-from-anywhere:
    port: 443
    ip:   'any'

vhost_proxies:
  admin-vhost:
    servername:    "%{::admin_vhost}"
    ssl:           true
    ssl_redirect:  true
    upstream_port: 7999
    access_logs:
      '{name}.access.log.json': 'json_event'
  www-vhost:
    servername:    "%{::www_vhost}"
    ssl:           true
    ssl_redirect:  true
    upstream_port: 7999
    access_logs:
      '{name}.access.log.json': 'json_event'

nginx::server::server_names_hash_bucket_size: 128

nginx_conf:
  logging:
    template: performanceplatform/nginx.logging.conf.erb

lumberjack_instances:
  nginx:
    log_files: [ '/var/log/nginx/*.access.log.json' ]
