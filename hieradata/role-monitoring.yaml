classes:
    - 'graphite'
    - 'logstash'
    - 'performanceplatform::nginx_server'
    - 'performanceplatform::monitoring'
    - 'redis'
    - 'rsyslog::server'

graphite::gr_apache_port:       9080
graphite::gr_apache_port_https: 9443

rsyslog::server::server_dir: '/srv/log/'

logstash::java_install: true
logstash::provider: 'custom'
logstash::jarfile: 'puppet:///modules/performanceplatform/logstash-1.1.13-monolithic.jar'

ufw_rules:
    allowcarbonfromanywhere:
        port: 2003
        ip:   'any'
    allowlumberjackfromanywhere:
        port: 3456
        ip:   'any'
    allowhttpfromall:
        port: 80
        ip:   'any'
    allowhttpsfromall:
        port: 443
        ip:   'any'
    allowsyslogfromanywhere:
        port: 514
        ip:   'any'

vhost_proxies:
    graphite-vhost:
        servername:      "%{::graphite_vhost}"
        ssl:             false
        upstream_server: 'localhost'
        upstream_port:   9080
        access_logs:
            '{name}.access.json.log': 'json_event'
        magic: |
            auth_basic "Enter username/password";
            auth_basic_user_file /etc/nginx/htpasswd;

nginx_conf:
    logging:
        template: performanceplatform/nginx.logging.conf.erb

lumberjack_instances:
    nginx:
        log_files: [ '/var/log/nginx/*.access.json.log' ]
        fields: { "tag": "nginx" }
